# æ¸¸æˆæœåŠ¡å™¨é¡¹ç›® (github.xubinbest.com/go-game-server)

## é¡¹ç›®ç®€ä»‹
è¿™æ˜¯ä¸€ä¸ªåŸºäºGoè¯­è¨€å¼€å‘çš„å¾®æœåŠ¡æ¶æ„æ¸¸æˆæœåŠ¡å™¨é¡¹ç›®ï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆå’Œäº‘åŸç”Ÿè®¾è®¡ç†å¿µã€‚é¡¹ç›®æ”¯æŒå¤šç§æ¸¸æˆæœåŠ¡ç»„ä»¶ï¼ŒåŒ…æ‹¬ç”¨æˆ·æœåŠ¡ã€ç¤¾äº¤æœåŠ¡ã€æ¸¸æˆæœåŠ¡ã€åŒ¹é…æœåŠ¡ã€æ’è¡Œæ¦œæœåŠ¡ç­‰ï¼Œä¸ºæ¸¸æˆæä¾›å®Œæ•´çš„åç«¯æ”¯æŒã€‚

## åŠŸèƒ½ç‰¹æ€§
- ğŸš€ é«˜æ€§èƒ½å¾®æœåŠ¡æ¶æ„
- ğŸ” å®Œæ•´çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- ğŸ‘¥ ç¤¾äº¤ç³»ç»Ÿæ”¯æŒï¼ˆå¥½å‹ã€å…¬ä¼šã€èŠå¤©ï¼‰
- ğŸ® æ¸¸æˆæ ¸å¿ƒæœåŠ¡
- ğŸ¯ æ™ºèƒ½åŒ¹é…ç³»ç»Ÿ
- ğŸ“Š å®æ—¶æ’è¡Œæ¦œ
- ğŸ’¬ WebSocketå®æ—¶é€šä¿¡
- ğŸ³ Kuberneteså®¹å™¨åŒ–éƒ¨ç½²
- ğŸ” NacosæœåŠ¡å‘ç°ä¸é…ç½®ä¸­å¿ƒ
- ğŸ“ å®Œå–„çš„æ—¥å¿—ç³»ç»Ÿï¼ˆzapï¼‰
- ğŸ“Š Prometheus + Grafanaç›‘æ§
- ğŸ”„ Kafkaæ¶ˆæ¯é˜Ÿåˆ—
- ğŸ—„ï¸ å¤šæ•°æ®åº“æ”¯æŒï¼ˆMySQLã€MongoDBã€Redisï¼‰
- ğŸ†” åˆ†å¸ƒå¼IDç”Ÿæˆï¼ˆé›ªèŠ±ç®—æ³•ï¼‰

## æŠ€æœ¯æ ˆ
- **ç¼–ç¨‹è¯­è¨€**: Go 1.23.0
- **ä¸»è¦æ¡†æ¶å’Œå·¥å…·**:
  - Webæ¡†æ¶ï¼šgorilla/mux
  - WebSocketï¼šgorilla/websocket
  - æ•°æ®åº“ï¼šMySQL, MongoDB, Redis
  - æœåŠ¡å‘ç°/é…ç½®ä¸­å¿ƒï¼šNacos/Etcd
  - æ—¥å¿—ï¼šzap
  - é™æµï¼šratelimit
  - RPCï¼šgRPC + Protocol Buffers
  - æ¶ˆæ¯é˜Ÿåˆ—ï¼šKafka (Sarama)
  - å®¹å™¨ç¼–æ’ï¼šKubernetes
  - ç›‘æ§ï¼šPrometheus + Grafana
  - JWTè®¤è¯ï¼šgolang-jwt

## é¡¹ç›®ç»“æ„
```
github.xubinbest.com/go-game-server/
â”œâ”€â”€ cmd/                    # æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ gateway/           # ç½‘å…³æœåŠ¡
â”‚   â”œâ”€â”€ user-service/      # ç”¨æˆ·æœåŠ¡
â”‚   â”œâ”€â”€ social-service/    # ç¤¾äº¤æœåŠ¡
â”‚   â”œâ”€â”€ game-service/      # æ¸¸æˆæœåŠ¡
â”‚   â”œâ”€â”€ match-service/     # åŒ¹é…æœåŠ¡
â”‚   â”œâ”€â”€ leaderboard-service/ # æ’è¡Œæ¦œæœåŠ¡
â”‚   â””â”€â”€ test/              # æµ‹è¯•æœåŠ¡
â”œâ”€â”€ internal/              # å†…éƒ¨åŒ…
â”‚   â”œâ”€â”€ auth/             # è®¤è¯ç›¸å…³
â”‚   â”œâ”€â”€ cache/            # ç¼“å­˜å±‚
â”‚   â”œâ”€â”€ config/           # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ db/               # æ•°æ®åº“æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ interfaces/   # æ•°æ®åº“æ¥å£
â”‚   â”‚   â”œâ”€â”€ models/       # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ mysql/        # MySQLå®ç°
â”‚   â”‚   â””â”€â”€ mongodb/      # MongoDBå®ç°
â”‚   â”œâ”€â”€ designconfig/     # è®¾è®¡é…ç½®
â”‚   â”œâ”€â”€ gateway/          # ç½‘å…³å®ç°
â”‚   â”œâ”€â”€ middleware/       # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ pb/               # Protocol Buffers å®šä¹‰
â”‚   â”œâ”€â”€ registry/         # æœåŠ¡æ³¨å†Œ
â”‚   â”œâ”€â”€ snowflake/        # IDç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ social/           # ç¤¾äº¤åŠŸèƒ½
â”‚   â”œâ”€â”€ user/             # ç”¨æˆ·ç›¸å…³
â”‚   â”œâ”€â”€ game_service/     # æ¸¸æˆæœåŠ¡
â”‚   â”œâ”€â”€ leaderboard/      # æ’è¡Œæ¦œæœåŠ¡
â”‚   â”œâ”€â”€ mq/               # æ¶ˆæ¯é˜Ÿåˆ—
â”‚   â””â”€â”€ utils/            # å·¥å…·å‡½æ•°
â”œâ”€â”€ dockerfile/           # Dockeré…ç½®æ–‡ä»¶
â”œâ”€â”€ K8s/                  # Kubernetesé…ç½®
â”‚   â”œâ”€â”€ DEPLOYMENT_GUIDE.md         # éƒ¨ç½²æ€»è§ˆ
â”‚   â”œâ”€â”€ DEPLOYMENT_GUIDE_YAML.md    # YAMLéƒ¨ç½²æŒ‡å—
â”‚   â”œâ”€â”€ DEPLOYMENT_GUIDE_HELM.md    # Helméƒ¨ç½²æŒ‡å—
â”‚   â”œâ”€â”€ namespace.yaml              # å‘½åç©ºé—´å®šä¹‰
â”‚   â”œâ”€â”€ secret.yaml                 # æ•æ„Ÿä¿¡æ¯Secret
â”‚   â”œâ”€â”€ Helm/                       # å„åŸºç¡€ç»„ä»¶Helm Chart
â”‚   â”‚   â”œâ”€â”€ mysql-cluster/         # MySQLé›†ç¾¤
â”‚   â”‚   â”œâ”€â”€ redis-cluster/         # Redisé›†ç¾¤
â”‚   â”‚   â”œâ”€â”€ nacos-cluster/         # Nacosé›†ç¾¤
â”‚   â”‚   â”œâ”€â”€ kafka-cluster/         # Kafkaé›†ç¾¤
â”‚   â”‚   â””â”€â”€ game-monitoring/       # ç›‘æ§ç»„ä»¶
â”‚   â”œâ”€â”€ Yaml/                       # å„åŸºç¡€ç»„ä»¶YAMLé…ç½®
â”‚   â”œâ”€â”€ Project/                    # ä¸šåŠ¡æœåŠ¡K8sé…ç½®
â”‚   â”œâ”€â”€ ingress/                    # Ingressé…ç½®
â”‚   â””â”€â”€ ...                         # å…¶ä»–K8sç›¸å…³æ–‡ä»¶
â”œâ”€â”€ data/                 # æ¸¸æˆæ•°æ®é…ç½®
â”‚   â”œâ”€â”€ csv/             # CSVæ ¼å¼æ•°æ®
â”‚   â””â”€â”€ xlsx/            # Excelæ ¼å¼æ•°æ®
â”œâ”€â”€ client/               # å®¢æˆ·ç«¯ç¤ºä¾‹
â”œâ”€â”€ scripts/              # è„šæœ¬æ–‡ä»¶
â”œâ”€â”€ sql/                  # æ•°æ®åº“è„šæœ¬
â””â”€â”€ examples/             # ç¤ºä¾‹ä»£ç 
```

## æ ¸å¿ƒæœåŠ¡

### ç½‘å…³æœåŠ¡ (Gateway)
- **èŒè´£**: è¯·æ±‚è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€WebSocketè¿æ¥ç®¡ç†
- **ç‰¹æ€§**: æ¶ˆæ¯è½¬å‘ã€å®¢æˆ·ç«¯è®¤è¯ã€é™æµç†”æ–­
- **é…ç½®**: [cmd/gateway/config.yaml](cmd/gateway/config.yaml)

### ç”¨æˆ·æœåŠ¡ (User Service)
- **èŒè´£**: ç”¨æˆ·è®¤è¯ã€æ³¨å†Œã€ç™»å½•ã€è£…å¤‡ç®¡ç†
- **ç‰¹æ€§**: JWTè®¤è¯ã€èƒŒåŒ…ç³»ç»Ÿã€è£…å¤‡ç³»ç»Ÿ
- **é…ç½®**: [cmd/user-service/config.yaml](cmd/user-service/config.yaml)

### ç¤¾äº¤æœåŠ¡ (Social Service)
- **èŒè´£**: å¥½å‹ç³»ç»Ÿã€å…¬ä¼šç³»ç»Ÿã€èŠå¤©åŠŸèƒ½
- **ç‰¹æ€§**: å®æ—¶èŠå¤©ã€å¥½å‹å…³ç³»ã€å…¬ä¼šç®¡ç†
- **é…ç½®**: [cmd/social-service/config.yaml](cmd/social-service/config.yaml)

### æ¸¸æˆæœåŠ¡ (Game Service)
- **èŒè´£**: æ¸¸æˆæ ¸å¿ƒé€»è¾‘ã€æˆ˜æ–—ç³»ç»Ÿ
- **ç‰¹æ€§**: æ¸¸æˆçŠ¶æ€ç®¡ç†ã€æˆ˜æ–—è®¡ç®—

### åŒ¹é…æœåŠ¡ (Match Service)
- **èŒè´£**: ç©å®¶åŒ¹é…ã€æˆ¿é—´ç®¡ç†
- **ç‰¹æ€§**: æ™ºèƒ½åŒ¹é…ç®—æ³•ã€æˆ¿é—´åˆ†é…

### æ’è¡Œæ¦œæœåŠ¡ (Leaderboard Service)
- **èŒè´£**: æ’è¡Œæ¦œæ•°æ®ç®¡ç†ã€åˆ†æ•°ç»Ÿè®¡
- **ç‰¹æ€§**: å®æ—¶æ’è¡Œæ¦œã€åˆ†æ•°æ’åº
- **é…ç½®**: [cmd/leaderboard-service/config.yaml](cmd/leaderboard-service/config.yaml)

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Go 1.23.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- Docker
- Kubernetesé›†ç¾¤
- NFSæœåŠ¡å™¨
- MySQL 8.0+
- Redis 6.0+
- Nacos 2.0+
- Kafka 2.8+

### æ„å»ºæ­¥éª¤

1. å…‹éš†é¡¹ç›®
```bash
git clone [é¡¹ç›®åœ°å€]
cd github.xubinbest.com/go-game-server
```

2. å®‰è£…ä¾èµ–
```bash
go mod download
```

3. ç”ŸæˆProtocol Buffersæ–‡ä»¶
```bash
./scripts/gen_proto.bat
```

4. æ„å»ºDockeré•œåƒ
```bash
# æ„å»ºæ‰€æœ‰æœåŠ¡
make build-all

# æˆ–å•ç‹¬æ„å»ºæœåŠ¡
make build-gateway
make build-social
make build-user
make build-leaderboard
```

5. æ¨é€é•œåƒåˆ°ä»“åº“
```bash
# æ¨é€æ‰€æœ‰æœåŠ¡é•œåƒ
make push-all

# æˆ–å•ç‹¬æ¨é€æœåŠ¡é•œåƒ
make push-gateway
make push-social
make push-user
make push-leaderboard
```

## éƒ¨ç½²è¯´æ˜

è¯¦ç»†çš„éƒ¨ç½²æŒ‡å—è¯·å‚è€ƒä»¥ä¸‹æ–‡æ¡£ï¼š

### éƒ¨ç½²æ€»è§ˆ
- [K8s/DEPLOYMENT_GUIDE.md](K8s/DEPLOYMENT_GUIDE.md) - å®Œæ•´çš„éƒ¨ç½²æŒ‡å—

### éƒ¨ç½²æ–¹å¼é€‰æ‹©
- [K8s/DEPLOYMENT_GUIDE_YAML.md](K8s/DEPLOYMENT_GUIDE_YAML.md) - ä½¿ç”¨YAMLæ–‡ä»¶éƒ¨ç½²
- [K8s/DEPLOYMENT_GUIDE_HELM.md](K8s/DEPLOYMENT_GUIDE_HELM.md) - ä½¿ç”¨Helm Chartéƒ¨ç½²

### éƒ¨ç½²æ­¥éª¤

1. **åŸºç¡€ç»„ä»¶éƒ¨ç½²**
   - å‘½åç©ºé—´å’ŒSecreté…ç½®
   - å­˜å‚¨ç±»é…ç½®
   - MySQLé›†ç¾¤éƒ¨ç½²
   - Redisé›†ç¾¤éƒ¨ç½²
   - Nacosé›†ç¾¤éƒ¨ç½²
   - Kafkaé›†ç¾¤éƒ¨ç½²

2. **ç›‘æ§ç»„ä»¶éƒ¨ç½²**
   - Prometheuséƒ¨ç½²
   - Grafanaéƒ¨ç½²

3. **ä¸šåŠ¡æœåŠ¡éƒ¨ç½²**
   - GatewayæœåŠ¡
   - SocialæœåŠ¡
   - UseræœåŠ¡
   - LeaderboardæœåŠ¡
   - Ingressé…ç½®

## å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ
- éµå¾ªGoæ ‡å‡†ä»£ç è§„èŒƒ
- ä½¿ç”¨gofmtæ ¼å¼åŒ–ä»£ç 
- ç¼–å†™å•å…ƒæµ‹è¯•
- æ·»åŠ å¿…è¦çš„æ³¨é‡Š
- ä½¿ç”¨ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶

### æäº¤è§„èŒƒ
```
feat: æ–°åŠŸèƒ½
fix: ä¿®å¤bug
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼
refactor: é‡æ„
test: æµ‹è¯•ç›¸å…³
chore: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨
```

### å¼€å‘å·¥å…·
- **åè®®ç”Ÿæˆ**: [scripts/gen_proto.bat](scripts/gen_proto.bat)
- **K8såŒæ­¥**: [scripts/sync_k8s.bat](scripts/sync_k8s.bat)
- **å¯åŠ¨è„šæœ¬**: [bin/scrpit/](bin/scrpit)

## æ•°æ®åº“è®¾è®¡

### å¤šæ•°æ®åº“æ¶æ„
- **MySQL**: ç”¨æˆ·æ•°æ®ã€ç¤¾äº¤å…³ç³»ã€æ¸¸æˆæ•°æ®ç­‰ç»“æ„åŒ–æ•°æ®
- **MongoDB**: èŠå¤©è®°å½•ã€æ¸¸æˆæ—¥å¿—ã€éç»“æ„åŒ–æ•°æ®
- **Redis**: ä¼šè¯ç®¡ç†ã€æ’è¡Œæ¦œã€å®æ—¶æ•°æ®ç¼“å­˜

### æ•°æ®æ¨¡å‹
- **ç”¨æˆ·æ¨¡å‹**: [internal/db/models/user.go](internal/db/models/user.go)
- **å¥½å‹æ¨¡å‹**: [internal/db/models/friend.go](internal/db/models/friend.go)
- **å…¬ä¼šæ¨¡å‹**: [internal/db/models/guild.go](internal/db/models/guild.go)
- **èƒŒåŒ…æ¨¡å‹**: [internal/db/models/inventory.go](internal/db/models/inventory.go)

## ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—ç³»ç»Ÿ
- ä½¿ç”¨zapè¿›è¡Œç»“æ„åŒ–æ—¥å¿—
- æ”¯æŒæ—¥å¿—è½®è½¬
- é›†æˆELKæ—¥å¿—åˆ†æ

### ç›‘æ§ç³»ç»Ÿ
- PrometheusæŒ‡æ ‡æ”¶é›†
- Grafanaä»ªè¡¨ç›˜å±•ç¤º
- æœåŠ¡å¥åº·æ£€æŸ¥
- æ€§èƒ½æŒ‡æ ‡ç›‘æ§

### å‘Šè­¦æœºåˆ¶
- æœåŠ¡å¼‚å¸¸å‘Šè­¦
- æ€§èƒ½æŒ‡æ ‡å‘Šè­¦
- èµ„æºä½¿ç”¨å‘Šè­¦

## å¸¸è§é—®é¢˜

### 1. æœåŠ¡å¯åŠ¨å¤±è´¥
- æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ä¾èµ–æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æ’æŸ¥é—®é¢˜

### 2. æ€§èƒ½é—®é¢˜
- æ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
- ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
- è°ƒæ•´ç¼“å­˜ç­–ç•¥

### 3. è¿æ¥é—®é¢˜
- æ£€æŸ¥ç½‘ç»œé…ç½®
- éªŒè¯æœåŠ¡å‘ç°é…ç½®
- ç¡®è®¤é˜²ç«å¢™è®¾ç½®

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤å˜æ›´ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»ºPull Request

## è®¸å¯è¯
[æ·»åŠ è®¸å¯è¯ä¿¡æ¯]

## è”ç³»æ–¹å¼
[æ·»åŠ è”ç³»æ–¹å¼]

## æ›´æ–°æ—¥å¿—

### v1.0.0
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒåŸºç¡€çš„æ¸¸æˆæœåŠ¡åŠŸèƒ½
- å®Œæ•´çš„å¾®æœåŠ¡æ¶æ„
- Kuberneteséƒ¨ç½²æ”¯æŒ 